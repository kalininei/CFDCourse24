@page notes Краткое содержание лекций

# 1. Введение (02.09)
Общее описание инфраструктуры проекта для работы по курсу лекций.

# 2. Уравнение Пуассона (09.09)

## Teма
Решение одномерной задачи Пуассона с граничными условиями первого рода методом конечных разностей.
Понятие о точности аппроксимации сеточной схемы.

## Постановка задачи
Рассматривается одномерное дифференциальное уравнение вида
\f{equation}{
    \label{eq:poisson1d}
    -\ddfrq{u}{x} = f(x)
\f}
в области \f$x\in[a,b]\f$ с граничными условиями первого рода
\f{equation}{
	\label{eq:poisson1d_bc}
	\begin{cases}
        u(a)=u_a,\\[5pt]
        u(b)=u_b.\\
	\end{cases}
\f}
Необходимо:
- Запрограммировать расчётную схему для численного решения этого уравнения методом конечных разностей
  на сетке с постоянным шагом,
- С помощью вычислительных экспериментов подтвердить порядок аппроксимации расчётной схемы.

## Метод решения

### Нахождение численного решения {#poisson1d_fdm}

В области решения \f$[a,b]\f$ введём равномерную сетку из \f$N\f$ ячеек.
Шаг сетки будет равен \f$h=(b-a)/N\f$.
Узлы сетки запишем в виде сеточного вектора \f$\{x_i\}\f$ длины \f$N+1\f$, где \f$i=\overline{0,N}\f$.
Определим сеточный вектор \f$\{u_i\}\f$ неизвестных, элементы которого определяют значение искомого численного решения в \f$i\f$-ом узле сетки. 

Разностная схема второго порядка для уравнения \f(\eqref{eq:poisson1d}\f) имеет вид
\f{equation}{
    \label{eq:poisson1d_fdm}
    \frac{-u_{i-1} + 2u_{i} - u_{i+1}}{h^2} = f_i, \qquad i=\overline{1,N-1}.
\f}
Здесь \f$\{f_i\}\f$ -- известный сеточный вектор, определяемый через известную
аналитическую функцию \f$f(x)\f$ в правой части уравнения \f(\eqref{eq:poisson1d}\f) как
\f{equation}{
    \label{eq:poisson1d_fdm2}
    f_i = f(x_i).
\f}

Аппроксимация граничных условий \f(\eqref{eq:poisson1d_bc}\f) первого рода даёт дополнительные 
сеточные уравнения для граничных узлов
\f{equation}{
    \label{eq:poisson1d_fdm_bc}
    \begin{array}{ll}
        u_0 = u_a,\\
        u_N = u_b
    \end{array}
\f}

Линейные уравнения \f(\eqref{eq:poisson1d_fdm}, \eqref{eq:poisson1d_fdm_bc}\f)
составляют систему вида

\f{equation*}{
    \sum_{j=0}^{N} A_{ij}\,u_j = b_i, \qquad i=\overline{0,N}
\f}
с матричными коэффициентами
\f{equation}{
    \label{eq:poisson1d_fdm_lhs}
    A_{ij} = \begin{cases}
        1,      &\quad i=0, \, j=0; \\
        2/h^2,  &\quad i=\overline{1,N-1}, \, j=i;\\
        -1/h^2, &\quad i=\overline{1,N-1}, \, j=i-1;\\
        -1/h^2, &\quad i=\overline{1,N-1}, \, j=i+1;\\
        1,      &\quad i=N, \, j=N; \\
        0,      &\quad {\text иначе}.
    \end{cases}
\f}
и правой частью
\f{equation}{
    \label{eq:poisson1d_fdm_rhs}
    b_i = \begin{cases}
        u_a,   &\quad i=0;\\
        u_b,   &\quad i=N;\\
        f_i,   &\quad i=\overline{1,N-1}.
    \end{cases}
\f}
Искомый вектор находится путём решения этой системы.

### Практическое определения порядка аппроксимации

Порядок аппрокцимации показывает скорость
приближения численного решения к точному с уменьшением сетки.
Поэтому для подтверждения порядка необходимо
- Знать точное решение,
- Уметь вычислять функционал (норму, \f(||\cdot||\f)), характеризующий отклонение точного решения от численного,
- Сделать несколько расчётов на сетках с разной \f(N\f)  и заполнить таблицу \f(||\{u_i - u^e(x_i)\}||(N)\f),
- На основе этой таблицы построить график в логарифмических осях и по углу наклона кривой сделать вывод о порядке аппроксимации.

Выберем произвольную функцию \f$u^e\f$ (достаточно сильно изменяющуюся на целевом отрезке \f$[a,b]\f$).

Далее путём прямого вычисления определим параметры задачи \f$f\f$, \f$u_a\f$, \f$u_b\f$ такие,
для которых функция \f$u^e\f$ является точным решением задачи \f(\eqref{eq:poisson1d}\f), \f(\eqref{eq:poisson1d_bc}\f).

Задамся числом разбиений \f$N\f$ и решим задачу для выбранным параметров.
В результате определим сеточный вектор численного решения \f$\{u_i\}\f$.

В качестве нормы выберем стандартное отклонение. В интегральном виде для многомерной функции \f$y(\vec x)\f$
в области \f$\vec x\in D\f$ оно имеет вид
\f{equation*}{
    ||y(\vec x)||_2 = \sqrt{\frac{1}{|D|}\int_{D} y(\vec x)^2 \, d\vec x}.
\f}
Упрощая до одномерного случая
\f{equation*}{
    ||y(x)||_2 = \sqrt{\frac{1}{b-a}\int_{a}^{b} y(x)^2 \, dx}.
\f}

Вычислим этот интеграл численно на введённой ранее равномерной сетке \f$\{x_i\}\f$:
\f{equation*}{
    ||\{y_i\}||_2 = \sqrt{\frac{1}{b-a}\sum_{i=0}^{N} w_i y_i^2},
\f}
где \f$\{w_i\}\f$ -- вес (или "площадь влияния") \f$i\f$-ого узла:
\f{equation*}{
    w_i = \begin{cases}
        h/2, &\quad i=0, N;\\
        h, &\quad i=\overline{1,N-1},
    \end{cases}
\f}
такая что
\f{equation*}{
    \sum_{i=0}^{N} w_i = b-a.
\f}

Окончательно среднеквадратичная норма отклонения численного решения от точного запишется в виде
\f{equation}{
    \label{eq:poisson1d_fdm_norm}
    ||\{u_i - u^e(x_i)\}||_2 = \sqrt{\frac{1}{b-a}\sum_{i=0}^{N} w_i \left(u_i - u^e_i\right)^2}.
\f}

## Программная реализация {#test_poisson1}
\dontinclude{lineno} poisson_solve_test.cpp

Тестовая программа для решения одномерного уравнения Пуассона 
реализована в фале poisson_solve_test.cpp.

В качестве аналитической тестовой функции  используется
\f{equation*}{
    u^e = \sin(10 x^2)
\f}
на отрезке \f$x\in[0,1]\f$.

### Функция верхнего уровня
объявлена как
\skip TEST_CASE("Poisson 1D solver", "[poisson1]"){
\until TEST_CASE
В программе в цикле по набору разбиений \c n_cells
\skip for (size_t n_cells
\until for (size_t n_cells
создаётся решатель для тестовой задачи, использующий заданное число ячеек
\skip worker
\until worker
вычисляется среднеквадратичная норма отклонения численного решения от точного
\skip n2
\until n2
полученное численное решение (вместе с точным) сохраняется в vtk файле "poisson1_ncells={10,20,...}.vtk"
\skip save_vtk
\until save_vtk
а полученная норма печатается в консоль напротив количества ячеек
\skip cout
\until cout

В результате работы программы в консоли должна отобразиться таблица вида
@code
--- cfd24_test [poisson1] ---
10 0.179124
20 0.0407822
50 0.00634718
100 0.00158055
200 0.000394747
500 6.31421e-05
1000 1.57849e-05
@endcode
где первый столбец -- это количество ячеек, а второй -- полученная для этого количества ячеек норма.
Нарисовав график этой таблицы в логарифмических осях подтвердим второй порядок аппроксимации.

\image html poisson1_appr.png width=800

Открыв один из cохранённых в процессе работы файлов vtk poisson1_ncells={}.vtk в паравью
можно посмотреть полученные графики. В файле представлены как точное "exact", так и численное решение "numerical".
Инструкции о настройке отображения одномерных графиков смотри \ref paraview-1d "здесь".

\image html poisson1_graph.png width=600

### Детали реализации
Основная работа по решению задачи проводится в классе \c TestPoisson1Worker.

В его конструкторе происходит инициализация сетки (приватного поля класса) на отрезке \f([0, 1]\f) с заданным разбиением \c n_cells:
\dontinclude{lineno} poisson_solve_test.cpp
\skip TestPoisson1Worker(
\until TestPoisson1Worker(

В методе \c solve() производится чиленное решения задачи и вычисления нормы.
Для этого последовательно
1. Строится матрица левой части и вектор правой части определяющей системы уравнений.
   Матрицы хранятся в разреженном формате CSR, удобном для последовательного чтения.
2. Вызывается решатель СЛАУ. Решение записывается в приватное поле класса \c u.
3. Вызывается функция вычисления нормы.

\skip double solve()
\until }

Функции нижнего уровня (используемые в методе \c solve):
- Сборка левой части СЛАУ. Реализует формулу \f(\eqref{eq:poisson1d_fdm_lhs}\f).
  Для заполнения матрицы используется формат cfd::LodMatrix, удобный для непоследовательной записи, который в конце конвертируется CSR.
  \skip approximate_lhs(
  \until return
  \until }

- Сборка правой части СЛАУ. Реализует формулу \f(\eqref{eq:poisson1d_fdm_rhs}\f).
  \skip approximate_rhs(
  \until return
  \until }

- Вычисление нормы. Реализует формулу \f(\eqref{eq:poisson1d_fdm_norm}\f).
  \skip double compute_norm2
  \until return
  \until }
